# ARplusR開発メモ

## 工程

- [x] ARマーカーから作られたオブジェクトの座標を取得する(とりあえずTextでリアルタイム表示)
- [x] タップした場所にオブジェクトを生成できるようにする
- [ ] オブジェクトにARマーカーが一定以上近づいたらARマーカーオブジェクトの色を変える
- [ ] Cubeが直進する用にする
- [ ] Cubeが障害物のオブジェクトに近づいたらそれを避けて進むようにする
- [ ] ロボットの実機の様子を見てmicro: bitでBLEするかRaspberry Piを使うかを決める
- [ ] 通信部分を作成
- [ ] 結合テスト
- [ ] 完成

---

## 方向性

  ARマーカーを認識して生成されたオブジェクト(以下仮想ロボットオブジェクト)は最終的には見えないようにする。2020年4月26日わかったことだが、どうやらそれはRendererを無効にすればいいらしい。仮想ロボットオブジェクトのColliderのX, Yの値を大きくし、OnTriggerStayで避ける処理を実行。避けるための動きの方向はUnity上で決定し、それを現実のロボットに配信する形をとる。AR上で現実のラジコンを動かすようなイメージ。

---

## 開発日記

### 2020年4月25日

 工程の最初である**"ARマーカーから作られたオブジェクトの座標を取得する"**はできた。しかし、予想と違って座標は相対的な変化であった。つまり、マーカーを動かすと座標が変化することはもちろんだが,自分自身(AR Camera)が動いても座標が変わった。しかし、結局やりたいことはAR上のオブジェクトとARマーカーを認識して生成されたオブジェクトとの相対的な距離がわかれば良いので、問題はなさそう。ARマーカーの認識が外れるともう一度認識させようとしてもうまく行かないことがほとんどであることがわかった。ARマーカーの認識精度自体は悪くないので、しっかりとカメラで追い続ければ大丈夫だと思われる。

### 2020年4月26日

 姿を消すにはhttps://marunouchi-tech.i-studio.co.jp/2356/によるとRendererをオフにすればいい。なるほど、言われてみればそうだ。仮想ロボットオブジェクトと障害物の接触検知はうまく行かなかった。仮想ロボットオブジェクトはARマーカーを認識すると生成されるオブジェクトで、AR Foundation のAR Tracked Image Managerスクリプトが管理している。Tracked Image PrefabにはCubeを指定している。障害物もほどんど同様のCubeのPrefabで、画面をタップするとAR上で平面と識別された場所に配置される。障害物のIsTriggerをtrueに、仮想ロボットオブジェクトのIsTriggerはfalseのままにして仮想ロボットオブジェクトのOnTriggerStayに

```c#
other.transform.Rotate(new Vector3(15, 30, 45) * Time.deltaTime);
```

としたが動かなかった。Debug.Logに出力することも試したが出力はなかった。OnTriggerEnterに同様にDebug.Logを試したが効果はなかった。(他のシチュエーションでDebug.Logが正常に動くことは確認済み)

